<?xml version='1.0' ?>
<!--
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  Copyright (c) 2012 - 2013 MAX Inc.    All Rights Reserved.
  Rev 1.6   Feb 16,2016     Nitika Arora     Changes for handling Cancel Menu letter.
  Rev 1.5	06/Aug/2013	  	Jyoti Bug 7522 - Reload Gift Card : Service items can be added to the transaction
   Rev 1.4	25/june/2013	Izhar            Cash Threshold
  Rev 1.3	20/June/2013	Prateek, Bug 6533 -Quantity screen is getting shown on pressinng sale associate and Gift Registry												   button of Item Option
  Rev 1.2	29/May/2013	  	Tanmaya, Bug 6049 - System Allow user to send home delivery in back date.
  Rev. 1.1 		Tanmaya		05/04/2013		Change for Scan and void
  Rev. 1.0 		Prateek		23/3/2013		Change for Quantity Button
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

/** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ************************
 * Copyright (c) 2013 Max Hypermarket.    All Rights Reserved. 
 *  Rev 1.1  12/April/2013               Himanshu              MAX-POS-PLU-ITEM-FES_v1.0.doc requirement.
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ***************************/
-->
<!DOCTYPE SERVICE SYSTEM "classpath://oracle/retail/stores/foundation/tour/dtd/tourguide.dtd">

<SERVICE
    name="ModifyItem"
    package="oracle.retail.stores.pos.services.modifyitem"
    tourcam="OFF">
    <COMMENT>
        This service implements the modify item use case
        and the use cases it calls.
    </COMMENT>
    <!-- MAX Rev 1.0 Change : Start -->
    <CARGO class="MAXItemCargo" package="max.retail.stores.pos.services.modifyitem">
        <COMMENT>
            This cargo contains a clone of the item to be modified.
        </COMMENT>
    </CARGO>
    <!-- MAX Rev 1.0 Change : End -->
    <SERVICECODE>
        <LETTER name="Failure"/>
        <LETTER name="Services"/>
        <LETTER name="Add"/>
        <LETTER name="Help"/>
        <LETTER name="Components"/>
        <LETTER name="No"/>
        <LETTER name="Success"/>
        <LETTER name="Cancel"/>
        <LETTER name="Clear"/>
        <LETTER name="Invalid"/>
        <LETTER name="ActivationCancelled"/>
        <LETTER name="GiftCardInquiry"/>
        <LETTER name="GiftRegistry"/>
        <LETTER name="IDError"/>
        <LETTER name="Inquiry"/>
        <LETTER name="InquiryReturnLetter"/>
        <LETTER name="Quantity"/>
        <LETTER name="SerialNumber"/>
        <LETTER name="Default"/>
        <LETTER name="Undo"/>
        <LETTER name="Next"/>
        <LETTER name="SalesAssociate"/>
        <LETTER name="Ok"/>
        <LETTER name="Tax"/>
        <LETTER name="Yes"/>
        <LETTER name="Continue"/>
        <LETTER name="GiftReceipt"/>
        <LETTER name="Send"/>
        <LETTER name="Override"/>
        <LETTER name="Loop"/>
        <LETTER name="Alterations"/>
        <LETTER name="GiftReceiptEligible"/>
        <LETTER name="Done"/>
        <LETTER name="ShippingMethod"/>
        <!-- MAX Rev 1.1 Change : Start -->
        <LETTER name="QuantityModify"/>
        <!-- MAX Rev 1.1 Change : end -->
		 <!-- MAX Rev 1.4 Change : Start -->
        <LETTER name="blockitem"/>
          <!-- MAX Rev 1.4 Change : end -->
       <!-- Shuttle -->
        <SHUTTLE class="SecurityOverrideLaunchShuttle" package="oracle.retail.stores.pos.services.admin.security.common"/>
        <SHUTTLE class="InquiryOptionsReturnShuttle"/>
        <SHUTTLE class="InquiryOptionsLaunchShuttle"/>
        <SHUTTLE class="ModifyItemTaxLaunchShuttle"/>
        <SHUTTLE class="ModifyItemTaxReturnShuttle"/>
        <SHUTTLE class="GiftCardInquiryLaunchShuttle"/>
        <SHUTTLE class="GiftCardInquiryReturnShuttle"/>
        <SHUTTLE class="KitComponentsLaunchShuttle"/>
        <SHUTTLE class="KitComponentsReturnShuttle"/>
        <SHUTTLE class="ModifyItemSerialNumberLaunchShuttle"/>
        <SHUTTLE class="MAXModifyItemSendLaunchShuttle" package="max.retail.stores.pos.services.modifyitem"/>
        <SHUTTLE class="ModifyItemSendReturnShuttle"/>
        <SHUTTLE  class="AlterationsLaunchShuttle"/>
        <SHUTTLE  class="AlterationsReturnShuttle"/>
        <SHUTTLE  class="DisplaySendMethodLaunchShuttle"/>
        
        <LANEACTION  class="RemoveItemRoad" package="oracle.retail.stores.pos.services.modifytransaction"/>
		<!-- MAX Rev 1.0 Change : Start  -->
        <LANEACTION class="MAXItemQuantityModifiedAisle" package="max.retail.stores.pos.services.modifyitem"/>
        <!-- MAX Rev 1.0 Change : End -->
        <LANEACTION class="PriceEnteredAisle" package="oracle.retail.stores.pos.services.common"/>
        <LANEACTION class="SetAccessRoleRoad"/>
        <LANEACTION class="DontAttachItemGiftRegistryAisle" package="oracle.retail.stores.pos.services.modifyitem"/>
        <LANEACTION class="FailureConversionAisle" package="oracle.retail.stores.pos.services.common"/>
        <LANEACTION class="AttachItemGiftRegistryAisle" package="oracle.retail.stores.pos.services.modifyitem"/>
        <LANEACTION class="ItemSerialModifiedAisle"/>
        <LANEACTION class="UndoItemInquiryAisle"/>
        <LANEACTION class="ServiceItemsErrorAisle"/>
        <LANEACTION class="ServiceItemSelectedAisle"/>
        <LANEACTION class="NextLetterAisle" package="oracle.retail.stores.pos.services.common"/>
        <LANEACTION class="ItemPriceModifiedAisle"/>
        <LANEACTION class="ItemGiftRegistryModifiedAisle"/>
        <LANEACTION class="GiftReceiptAssignedAisle"/>
        <LANEACTION class="GiftReceiptCheckEligibilityAisle"/>
        <LANEACTION class="CancelLetterAisle" package="oracle.retail.stores.pos.services.common"/>
         <!-- MAX Rev 1.1 Change : Start -->
        <LANEACTION class="MAXCheckWeightedItemQuantityAisle" package="max.retail.stores.pos.services.modifyitem"/>
        <!-- MAX Rev 1.1 Change : end -->
        
         <!-- MAX Rev 1.4 Change : Start -->
        <SITEACTION class="MAXModifyItemSite" package="max.retail.stores.pos.services.modifyitem"/>
        <!-- MAX Rev 1.4 Change : end -->
        <SITEACTION class="MAXLookupServiceItemsSite" package="max.retail.stores.pos.services.modifyitem"/>
       <SITEACTION class="ModifyItemSalesAssociateSite"/>
               <!-- MAX Rev 1.5 Change : start -->
        <SITEACTION class="MAXAddItemSite" package="max.retail.stores.pos.services.modifyitem"/>
	               <!-- MAX Rev 1.5 Change : end -->
        <SITEACTION class="ValidateSalesAssociateSite"/>
        <SITEACTION class="CheckPriceEntrySite" package="oracle.retail.stores.pos.services.common"/>
        <SITEACTION class="SelectServiceItemSite"/>
		<SITEACTION class="MAXCheckCustomerSite" package="max.retail.stores.pos.services.modifyitem"/>        
         <!-- MAX Rev 1.1 Change : Start -->
        <SITEACTION class="MAXModifyItemQuantitySite" package="max.retail.stores.pos.services.modifyitem"/>
        <!-- MAX Rev 1.1 Change : end -->
        
        <SITEACTION class="ItemCheckReturnLetterSite"/>
        <SITEACTION class="ModifyItemGiftRegistrySite"/>
        <SITEACTION class="CheckAccessSite" package="oracle.retail.stores.pos.services.admin.security.common"/>
        <!-- MAX Rev 1.0 Change : Start -->
		<SITEACTION class="MAXDetermineModifyItemQuantitySite" package="max.retail.stores.pos.services.modifyitem"/>
		<!-- MAX Rev 1.0 Change : End -->
		<SIGNAL  class="IsScanAndVoidSignal" package="max.retail.stores.pos.services.sale"/>
		<SIGNAL  class="IsNotScanAndVoidSignal" package="max.retail.stores.pos.services.sale"/>

    </SERVICECODE>
    <MAP>
    	<!-- MAX Rev 1.0 Change : Start -->
        <REGION region="SERVICE" startsite="MAXDetermineModifyItemQuantityMenu">
        	<SITE name="MAXDetermineModifyItemQuantityMenu" siteaction="MAXDetermineModifyItemQuantitySite">

        	   <!-- MAX Rev 1.1 Change : Start -->
                <AISLE
					name="MAXWeightedItemQuantityAisle"
					letter="ModifyQuantity"
					laneaction="MAXCheckWeightedItemQuantityAisle">
				</AISLE>
				
				 <ROAD
						name="LoopModifyItemMenu"
						letter="Loop"
						destination="Final"
						tape="ADVANCE"
						record="OFF"
						index="OFF">
				</ROAD>
			
              	<ROAD
                  	name="ModifyItemQuantity"
                  	letter="QuantityModify"
                  	destination="ModifyItemQuantity"
                  	tape="ADVANCE" record="OFF" index="OFF">
              	</ROAD>
      
              	<!-- MAX Rev 1.1 Change : end -->
              	<ROAD
                  	name="ModifyItemMenu"
                  	letter="Item"
                  	destination="ModifyItemMenu"
                  	tape="ADVANCE" record="OFF" index="OFF">
              	</ROAD>
               	<ROAD
                  	name="ModifyItemMenuFailure"
                  	letter="Failure"
                  	destination="Final"
                  	tape="ADVANCE" record="OFF" index="OFF">
              	</ROAD>
          	</SITE>
        <!-- MAX Rev 1.0 Change : End -->
           <SITE name="CheckAccess" siteaction="CheckAccessSite">
              <ROAD
                  name="AccessDEnied"
                  letter="Override"
                  destination="SecurityOverrideStation"
                  tape="ADVANCE" record="OFF" index="OFF">
              </ROAD>
			  <!--MAX Rev 1.3 Change : Start -->
              <ROAD
                  name="AccessGranted"
                  letter="Continue"
                  destination="CheckReturnLetter"
                  tape="ADVANCE" record="OFF" index="OFF">
              </ROAD>
			  <!--MAX Rev 1.3 Change : End -->
          </SITE>
          <STATION name="SecurityOverrideStation"
              servicename="security.override.override"
              targettier="CURRENTTIER"
              launchshuttle="SecurityOverrideLaunchShuttle" >
              <ROAD
                  name="SecurityOverrideGranted"
                  letter="Success"
                  destination="CheckReturnLetter"
                  tape="ADVANCE" record="OFF" index="OFF">
              </ROAD>
              <!-- MAX Rev 1.0 Change : Start -->
              <ROAD
                  name="SecurityOverrideDenied"
                  letter="Failure"
                  destination="MAXDetermineModifyItemQuantityMenu"
                  tape="ADVANCE" record="OFF" index="OFF">
              </ROAD>
              <!-- MAX Rev 1.0 Change : End -->
              <ROAD
                  name="SecurityOverrideCancelled"
                  letter="Cancel"
                  destination="Final"
                  tape="ADVANCE" record="OFF" index="OFF">
              </ROAD>
           </STATION>
           <!-- MAX Rev 1.4 Change : Start -->
           <SITE name="ModifyItemMenu" siteaction="MAXModifyItemSite">
           <!-- MAX Rev 1.4 Change : end -->
                <AISLE
                    name="GiftReceiptCheckEligibility"
                    letter="GiftReceipt"
                    laneaction="GiftReceiptCheckEligibilityAisle">
                    <COMMENT>
                        Show diaglog screen if not all items are eligible,
                        then flow continues.
                    </COMMENT>
                </AISLE>
                <AISLE
                    name="GiftReceiptSelected"
                    letter="GiftReceiptEligible"
                    laneaction="GiftReceiptAssignedAisle">
                    <COMMENT>
                        This aisle will assign a gift receipt attribute to
                        the SaleReturnLineItem and mail the Final letter,
                        Next to the calling service.
                    </COMMENT>
                </AISLE>
                 
                  <!-- MAX Rev 1.1 Change : Start -->
                <AISLE
					name="MAXWeightedItemQuantityAisle"
					letter="Quantity"
					laneaction="MAXCheckWeightedItemQuantityAisle">
				</AISLE>
				
				 <ROAD
						name="UndoModifyItemMenu"
						letter="Loop"
						destination="ModifyItemMenu"
						tape="ADVANCE"
						record="OFF"
						index="OFF">
				</ROAD>
				
			    <!-- MAX Rev 1.1 Change : end -->
				 <!-- MAX Rev 1.4 Change : start -->
				<ROAD name="BlockItem"
                     letter="blockitem"
                     destination="Final"
                     tape="ADVANCE" record="ON" index="ON">
                     <COMMENT>
                         This road is traversed when the user select gift registry.
                     </COMMENT>
               </ROAD>
                <!-- MAX Rev 1.4 Change : end -->
                <ROAD
                    name="UndoModifyItemMenu"
                    letter="Undo"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>

                <ROAD
                    name="ItemGiftRegistry"
                    letter="GiftRegistry"
                    laneaction="SetAccessRoleRoad"
                    destination="CheckAccess"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                
                <!-- MAX Rev 1.1 Change : Start -->
               <ROAD
                    name="ModifyItemQuantityRoad"
                    letter="QuantityModify"
                    destination="ModifyItemQuantity"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                  <!-- MAX Rev 1.1 Change : end -->
                 
                <ROAD
                    name="InquiryOptions"
                    letter="Inquiry"
                    destination="InquiryOptionsStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ItemSalesAssociate"
                    letter="SalesAssociate"
                    laneaction="SetAccessRoleRoad"
                    destination="CheckAccess"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ItemTax"
                    letter="Tax"
                    destination="ModifyItemTaxStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ServicesSelected"
                    letter="Services"
                    destination="LookupServiceItems"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="InquiryGiftCard"
                    letter="GiftCardInquiry"
                    destination="GiftCardInquiryStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ModifySerialNumber"
                    letter="SerialNumber"
                    destination="SerializedItemStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="SendSelected"
                    letter="Send"
                    destination="CheckCustomer"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="DisplayComponentOptionsRoad"
                    letter="Components"
                    destination="ModifyKitComponentsStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD 
                    name="ModifyAlterationsSelected"
                    letter="Alterations"
                    destination="ModifyAlterationsStation"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
            </SITE>
			<SITE name="CheckCustomer" siteaction="MAXCheckCustomerSite">
           		<ROAD
                    name="CustomerPresent"
                    letter="Success"
                    destination="ModifyItemSendStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CustomerNotPresent"
                    letter="Failure"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
           </SITE>
            <STATION
                name="ModifyKitComponentsStation"
                servicename="modifyitem.kit.components"
                targettier="CURRENTTIER"
                launchshuttle="KitComponentsLaunchShuttle"
                returnshuttle="KitComponentsReturnShuttle">
                <ROAD
                    name="UndoComponentOptions"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Kit Components service
                        returns with an Undo letter.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="ComponentOptionsOk"
                    letter="Ok"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ComponentOptionsNext"
                    letter="Next"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CancelKitComponents"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road goes to the Final site.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="ComponentOptionsClear"
                    letter="Clear"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </STATION>

             <!-- MAX Rev 1.1 Change : Start -->
            <SITE name="ModifyItemQuantity" siteaction="MAXModifyItemQuantitySite">
                <!-- MAX Rev 1.1 Change : end -->
                <COMMENT>
                    This site implements steps 2, and 3 of the modify item
                    quantity use case. Prompt for the new quantity. A
                    null quantity will not be allowed by the UI. Store
                    the user specified quantity as the new item quantity.
                    Record the new quantity for this item in the journal.
                    Set transaction-item? in return shuttle . Actual
                    updating of quantity and totals is done in the business
                    object. Mail final letter to parent.
                </COMMENT>
                <!-- MAX Rev 1.0 Change : Start -->
                <AISLE
                    name="ItemQuantityModified"
                    letter="Next"
                    laneaction="MAXItemQuantityModifiedAisle">
                    <COMMENT>
                        Get UI input Put it into cargo Mail final letter to
                        parent.
                    </COMMENT>
                </AISLE>
                <!-- MAX Rev 1.0 Change : End -->
                
                <ROAD
                    name="TotalLiquor"
                    letter="Ok"
                    destination="MAXDetermineModifyItemQuantityMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    
                </ROAD>
                
                <ROAD
                    name="UpdateShippingMethod"
                    letter="ShippingMethod"
                    destination="DisplaySendMethodStation"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        Update shipping method if the item is send item.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="RetryItemQuantity"
                    letter="Loop"
                    destination="ModifyItemQuantity"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        traversed it and invalid quantity is entered.
                        returns to item quantitny screen to reenter quantity
                    </COMMENT>
                </ROAD>

                <ROAD
                    name="CancelItemQuantity"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        send a final letter with a parm telling the parent
                        to give up
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoItemQuantity"
                    letter="Undo"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        Go to the main item menu options.
                    </COMMENT>
                    <LIGHT  signal="IsNotScanAndVoidSignal"/>
                </ROAD>
                <ROAD
                    name="UndoItemQuantity"
                    letter="Undo"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        Go to the main item menu options.
                    </COMMENT>
                    <LIGHT  signal="IsScanAndVoidSignal"/>
                </ROAD>
            </SITE>
            <SITE name="ModifyItemSalesAssociate" siteaction="ModifyItemSalesAssociateSite">
                <COMMENT>
                    This site implements steps 2, and 3 of the modify item
                    sales associate use case. Prompt for the new sales
                    associate. The current sales associate will be the
                    default for the prompt. The user enters a sales associate
                    or clears the default. If the default is cleared,
                    the cashier is set as the new sales associate for the
                    item. Store the user specified sales associate as
                    the new sales associate for the selected item. Record
                    the new sales associate for this item in the journal.
                    Set transaction-item? in return shuttle Mail final
                    letter to parent.
                </COMMENT>
                <ROAD
                    name="CancelItemSalesAssociate"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        send a final letter with a parm telling the parent
                        to give up
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoItemSalesAssociate"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        Go back to the Main Modify items menu.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="SalesAssociateModified"
                    letter="Next"
                    destination="ValidateSalesAssociate"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </SITE>
            <STATION
                name="InquiryOptionsStation"
                servicename="services.inquiry.inquiryoptions"
                targettier="CURRENTTIER"
                launchshuttle="InquiryOptionsLaunchShuttle"
                returnshuttle="InquiryOptionsReturnShuttle">
                <COMMENT>
                    This station is the transfer point for the InquiryOptions
                    service.
                </COMMENT>
                <ROAD
                    name="InquiryReturned"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Inquiry Options service
                        returns.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoInquiry"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    laneaction="UndoItemInquiryAisle"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Item Inquiry service
                        returns with an Undo letter.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="AddItemToTransaction"
                    letter="Add"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Item Inquiry service
                        returns with an Add letter.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="CancelEntered"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road goes to the Final site.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="AccessDenied"
                    letter="Failure"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road goes to the Final site.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="InvalidAgeForItem"
                    letter="Invalid"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CamcelMenuInquiry"
                    letter="CancelMenu"
                    destination="ModifyItemMenu"
                    laneaction="UndoItemInquiryAisle"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Item Inquiry service
                        returns with an CancelMenu letter.
                    </COMMENT>
                </ROAD>
                
            </STATION>

            <SITE name="ModifyItemGiftRegistry" siteaction="ModifyItemGiftRegistrySite">
                <COMMENT>
                    This site implements steps 2, 3, and 4 of the modify
                    item gift registry use caseflow. Prompt for new gift
                    registry number. Store the user specified gift registry
                    number in the item. Update the item with new gift registry
                    number according to the transaction policy. Record
                    the registry number and gift item information in
                    the journal. Set transaction-item? in return shuttle
                    Mail final letter to parent.
                </COMMENT>
                <AISLE
                    name="ItemGiftRegistryModified"
                    letter="Next"
                    laneaction="ItemGiftRegistryModifiedAisle">
                    <COMMENT>
                        Get UI input. Put it into cargo. Mail final letter
                        to parent.
                    </COMMENT>
                </AISLE>
                <AISLE
                    name="DontAttachItemGiftRegistry"
                    letter="No"
                    laneaction="DontAttachItemGiftRegistryAisle">
                </AISLE>
                <AISLE
                    name="AttachItemGiftRegistry"
                    letter="Yes"
                    laneaction="AttachItemGiftRegistryAisle">
                </AISLE>
                <ROAD
                    name="CancelItemGiftRegistry"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        send a final letter with a parm telling the parent
                        to give up
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoItemGiftRegistry"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road goes to the Main Modify Item Menu.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="ItemRegistryOkEntered"
                    letter="Ok"
                    destination="ModifyItemGiftRegistry"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ItemRegistryYesEntered"
                    letter="Yes"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ItemRegistryNoEntered"
                    letter="No"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </SITE>

            <STATION
                name="ModifyItemTaxStation"
                servicename="modifyitem.tax.ModifyItemTax"
                targettier="CURRENTTIER"
                launchshuttle="ModifyItemTaxLaunchShuttle"
                returnshuttle="ModifyItemTaxReturnShuttle">
                <COMMENT>
                    This station goes to the Modify Tax Service.
                </COMMENT>
                <ROAD
                    name="SuccessfulChange"
                    letter="Success"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when a successful change is made.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="MulitpleItemTaxChangeNo"
                    letter="No"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when the user chooses to not make a tax change to 
                        entry(s) that have already been changed.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="NextTax"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when a Next letter is received
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="CancelTax"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when the Cancel Letter is received.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="AccessFailureTax"
                    letter="Failure"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when the Failure Letter is received.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoTax"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when a Undo letter is received
                        from the Modify Item Tax service.
                    </COMMENT>
                </ROAD>
            </STATION>
            <SITE name="LookupServiceItems" siteaction="MAXLookupServiceItemsSite">
                <COMMENT>
                    Retrieves a list of service items from the data source.
                </COMMENT>
                <AISLE
                    name="NoServiceItemsFound"
                    letter="Failure"
                    laneaction="ServiceItemsErrorAisle">
                    <COMMENT>
                        This aisle is traversed is no service items are found.
                    </COMMENT>
                </AISLE>
                <AISLE
                    name="NoServiceItemsAcknowledged"
                    letter="Ok"
                    laneaction="NextLetterAisle">
                </AISLE>
                <ROAD
                    name="ServiceItemsFound"
                    letter="Success"
                    destination="SelectServiceItem"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled if there are service items.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="NoServices"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled if there are no service items.
                    </COMMENT>
                </ROAD>
            </SITE>
            <SITE name="CheckReturnLetter" siteaction="ItemCheckReturnLetterSite">
                <ROAD
                    name="ReturnGiftRegistry"
                    letter="GiftRegistry"
                    destination="ModifyItemGiftRegistry"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ReturnSalesAssociate"
                    letter="SalesAssociate"
                    destination="ModifyItemSalesAssociate"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="ReturnDefault"
                    letter="Default"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </SITE>
            <SITE name="SelectServiceItem" siteaction="SelectServiceItemSite">
                <AISLE
                    name="ServiceItemSelected"
                    letter="Next"
                    laneaction="ServiceItemSelectedAisle">
                    <COMMENT>
                        Stores the selected item in the cargo
                    </COMMENT>
                </AISLE>
                <ROAD
                    name="NextServiceItem"
                    letter="Continue"
                    destination="CheckPriceEntry"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="AlterationsSelected"
                    letter="Alterations"
                    destination="AlterationStation"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD
                    name="CancelServices"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="UndoServices"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </SITE>
            <SITE name="CheckPriceEntry" siteaction="CheckPriceEntrySite">
                <COMMENT>
                    This site checks to see if price entry is required
                    for the item.
                </COMMENT>
                <AISLE
                    name="PriceEntered"
                    letter="Next"
                    laneaction="PriceEnteredAisle">
                    <COMMENT>
                        This aisle is traversed when the user presses the
                        Next key in the ENTER_PRICE screen.
                    </COMMENT>
                </AISLE>
                <ROAD
                    name="HasPrice"
                    letter="Continue"
                    destination="AddItem"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the Item has a price.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="UndoPrice"
                    letter="Undo"
                    destination="SelectServiceItem"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the user presses the Undo
                        key in the ENTER_PRICE menu.
                    </COMMENT>
                </ROAD>
                <ROAD
                    name="CancelPrice"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traveled when the user presses the Cancel
                        key from the ENTER_PRICE screen.
                    </COMMENT>
                </ROAD>
            </SITE>
            <SITE name="AddItem" siteaction="MAXAddItemSite">
                <COMMENT>
                    This site updates the transaction with the new item
                </COMMENT>
                <AISLE
                    name="ItemAddedContinue"
                    letter="Continue"
                    laneaction="NextLetterAisle">
                </AISLE>
		               <!-- MAX Rev 1.5 Change : start -->
                <ROAD
                    name="ItemNotAdded"
                    letter="Invalid"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when the Item has been added
                        to the transaction.
                    </COMMENT>
                </ROAD>
		               <!-- MAX Rev 1.5 Change : end -->
                <ROAD
                    name="ItemAddedNext"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                    <COMMENT>
                        This road is traversed when the Item has been added
                        to the transaction.
                    </COMMENT>
                </ROAD>
            </SITE>

            <SITE name="ValidateSalesAssociate" siteaction="ValidateSalesAssociateSite">
                <ROAD
                    name="ValidSalesAssociate"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="InValidSalesAssociate"
                    letter="Ok"
                    destination="ModifyItemSalesAssociate"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </SITE>

            <STATION
                name="GiftCardInquiryStation"
                servicename="inquiry.giftcardinquiry.inquiry"
                targettier="CURRENTTIER"
                launchshuttle="GiftCardInquiryLaunchShuttle">
                <AISLE name="ConvertActivationCancelledToCancel"
                       letter="ActivationCancelled"
                       laneaction="CancelLetterAisle">
                </AISLE>
                <ROAD
                    name="GiftCardInquiryCompleted"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="UndoGiftCardInquiry"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CancelGiftCardInquiry"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="FailedGiftCardInquiry"
                    letter="Failure"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </STATION>
            <STATION
                 name="SerializedItemStation"
                 servicename="modifyitem.serialnumber.serializedItem"
                 targettier="CURRENTTIER"
                 launchshuttle="ModifyItemSerialNumberLaunchShuttle">
                 <COMMENT>
                     This service prompts the user for serial number input and sets the serial number attribute
                     for one or more line items.
                 </COMMENT>
                 <ROAD
                     name="SerializedItemUndo"
                     letter="Undo"
                     destination="ModifyItemMenu">
                 </ROAD>
                 <ROAD
                     name="SerializedItemCancel"
                     letter="Cancel"
                     destination="Final">
                 </ROAD>
                 <ROAD
                     name="SerialNumbersEntered"
                     letter="Ok"
                     destination="Final">
                 </ROAD>
            </STATION>

            <STATION
                 name="ModifyItemSendStation"
                 servicename="services.send.send"
                 targettier="CURRENTTIER"
                 launchshuttle="MAXModifyItemSendLaunchShuttle"
                 returnshuttle="ModifyItemSendReturnShuttle">
                 <COMMENT>
                      This station is the transfer point for the send
                      service.
                 </COMMENT>
                 <ROAD
                    name="NonMerchandiseItemFound"
                    letter="Ok"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="SendSuccessfullyCompleted"
                    letter="Done"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="UndoPressedDuringCutomerLink"
                    letter="Undo"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CancelPressedDuringCutomerLink"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CustomerIDEnteredDuringCutomerLink"
                    letter="Continue"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CustomerAlreadyLinked"
                    letter="Success"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
                <ROAD
                    name="CustomerNotLinked"
                    letter="Failure"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="OFF">
                </ROAD>
            </STATION>
            <STATION 
                name="AlterationStation"
                servicename="services.alterations.alterations"
                targettier="CURRENTTIER"
                launchshuttle="AlterationsLaunchShuttle"
                returnshuttle="AlterationsReturnShuttle">
                 <ROAD 
                    name="AlterationsCompleted"
                    letter="Continue"
                    destination="Final"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD 
                    name="UndoAlterations"
                    letter="Undo"
                    destination="SelectServiceItem"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD 
                    name="CancelAlterations"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD 
                    name="CancelAlterationsNoCustomer"
                    letter="No"
                    destination="SelectServiceItem"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
            </STATION>
            <STATION 
                name="ModifyAlterationsStation"
                servicename="services.alterations.alterations"
                targettier="CURRENTTIER"
                launchshuttle="AlterationsLaunchShuttle"
                returnshuttle="AlterationsReturnShuttle">
                <COMMENT >
                    This station sends an alteration item to the Alterations 
                    Service for modification.
                </COMMENT>
                <ROAD 
                    name="ModifyAlterationsCompleted"
                    letter="Continue"
                    destination="Final"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD 
                    name="ModifyAlterationsCanceled"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
                <ROAD 
                    name="ModifyAlterationsUndone"
                    letter="Undo"
                    destination="ModifyItemMenu"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
            </STATION>
            <STATION
                name="DisplaySendMethodStation"
                servicename="send.displaysendmethod.displaysendmethod"
                targettier="CURRENTTIER"
                launchshuttle="DisplaySendMethodLaunchShuttle">
                <COMMENT>
                    This station goes to the display send method station for updating 
                    shipping method.
                </COMMENT>
                <AISLE 
                    name="SuccessSelectedAisle"
                    letter="Success"
                    laneaction="NextLetterAisle">
                </AISLE>
				<AISLE 
                    name="DoneSelectedAisle"
                    letter="Done"
                    laneaction="NextLetterAisle">
                </AISLE>
                <ROAD
                    name="=BackToSaleItem"
                    letter="Next"
                    destination="Final"
                    tape="ADVANCE"
                    record="OFF"
                    index="ON">
                    <COMMENT>
                        This road is traversed when a Done and then Next letter is received
                    </COMMENT>
                </ROAD>
            </STATION>   
            
            
                     
            <SYSTEMSITE name="Final" action="RETURN"/>
        </REGION>
    </MAP>
</SERVICE>
