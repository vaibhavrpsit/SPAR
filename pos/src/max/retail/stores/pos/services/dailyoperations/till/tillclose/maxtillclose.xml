<?xml version='1.0' ?>
<!-- 
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *

  Copyright (c) 1998-2001 360Commerce, Inc.    All Rights Reserved.
  Rev 1.1  06/jun/2013	Jyoti Rawal, Fix for bug 5792 POS hanges on pressing Enter button.
  Rev 1.0  02/May/2013	Jyoti Rawal, Change for GiftCard  Integration.  
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 -->
<!DOCTYPE SERVICE SYSTEM "classpath://oracle/retail/stores/foundation/tour/dtd/tourguide.dtd">

<SERVICE name="TillClose" package="oracle.retail.stores.pos.services.dailyoperations.till.tillclose" tourcam="OFF">
     <COMMENT>
          Service called when closing a Till.
     </COMMENT>
<CARGO class="TillCloseCargo">
</CARGO>
<SERVICECODE>
     <LETTER name="Success"/>
     <LETTER name="Failure"/>
     <LETTER name="Yes"/>
     <LETTER name="No"/>
     <LETTER name="Ok"/>
     <LETTER name="Cancel"/>
     <LETTER name="Undo"/>
     <LETTER name="Retry"/>
     <LETTER name="Next"/>
     <LETTER name="Continue"/>
     <LETTER name="TillError"/>
     <LETTER name="UpdateError"/>
     <LETTER name="Override"/>
     <!--Changes done for HDD Full Patch From Oracle Start-->
     <LETTER name="QueueFull"/>
     <!--Changes done for HDD Full Patch From Oracle-->
     <SITEACTION class="CheckStatusSite" />
     <SITEACTION class="EnterTillSite" />
     <SITEACTION class="OpenDrawerSite" />
     <SITEACTION class="TillReconcileOptionSite" />
     <SITEACTION class="CloseDrawerSite" />
     <SITEACTION class="UpdateStatusSite"/>
     <SITEACTION class="WriteHardTotalsSite" package="oracle.retail.stores.pos.services.common" />
     <SITEACTION class="CheckAccessSite" package="oracle.retail.stores.pos.services.admin.security.common"/>
     <SITEACTION class="PromptRemoveTillSite" package="oracle.retail.stores.pos.services.dailyoperations.common"/>

     <SHUTTLE class="SecurityOverrideLaunchShuttle" package="oracle.retail.stores.pos.services.admin.security.common"/>
     <SHUTTLE class="TillReconcileLaunchShuttle" />
     <SHUTTLE class="TillReconcileReturnShuttle" />
     
     <LANEACTION class="TillEnteredAisle" />
     <LANEACTION class="DrawerOpenedAisle" />
     <LANEACTION class="UpdateStatusErrorAisle" />
     <LANEACTION class="WriteHardTotalsErrorAisle" package="oracle.retail.stores.pos.services.common" />
     <LANEACTION class="FailureConversionAisle" package="oracle.retail.stores.pos.services.common" />
     <LANEACTION class="DataBaseErrorAisle" package="oracle.retail.stores.pos.services.common" template="laneaction.tpl" />     
     <LANEACTION class="RemoveTillRoad" package="oracle.retail.stores.pos.services.dailyoperations.common" />
     <LANEACTION class="DisplayErrorAisle" package="oracle.retail.stores.pos.services.dailyoperations.till" />
     <LANEACTION class="SuccessConversionAisle" package="oracle.retail.stores.pos.services.common" />
     <!-- Rev 1.0 -->
     <LANEACTION class="MAXGiftCardBatchCloseAisle" package="max.retail.stores.pos.services.giftcard"/>
     
     <SIGNAL class="IsRequestedServiceTillReconcileSignal" package="oracle.retail.stores.pos.services.dailyoperations.till.tillreconcile" />

</SERVICECODE>
<MAP>
     <REGION region="SERVICE" startsite="CheckAccess">
            <SITE name="CheckAccess" siteaction="CheckAccessSite">
                <ROAD
                    name="NoAccess"
                    letter="Override"
                    destination="SecurityOverrideStation">
                </ROAD>
                <ROAD
                    name="UserAuthorized"
                    letter="Continue"
                    destination="CheckStatus">
                    <LIGHT signal="IsRequestedServiceTillReconcileSignal" negate="Y"/>
                </ROAD>
                <ROAD
                    name="UserAuthorizedFromReconcile"
                    letter="Continue"
                    destination="PromptRemoveTill">
                    <LIGHT signal="IsRequestedServiceTillReconcileSignal"/>
                </ROAD>
            </SITE>
            <STATION name="SecurityOverrideStation"
                servicename="security.override.override"
                targettier="CURRENTTIER"
                launchshuttle="SecurityOverrideLaunchShuttle" >
                <ROAD
                    name="CloseTillSucceededSecurityOverride"
                    letter="Success"
                    destination="CheckStatus"
                    tape="ADVANCE" record="OFF" index="OFF">
                    <LIGHT signal="IsRequestedServiceTillReconcileSignal" negate="Y"/>
                </ROAD>
                <ROAD
                    name="CloseTillSucceededFromReconcile"
                    letter="Success"
                    destination="PromptRemoveTill"
                    tape="ADVANCE" record="OFF" index="OFF">
                    <LIGHT signal="IsRequestedServiceTillReconcileSignal"/>
                </ROAD>
                <ROAD
                    name="SecurityOverrideFailed"
                    letter="Failure"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
                <ROAD
                    name="SecurityOverrideCancelled"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
          </STATION>         
          <SITE name="CheckStatus" siteaction="CheckStatusSite">
               <AISLE name="CheckStatusTillError"
                      letter="TillError"
                      laneaction="DisplayErrorAisle">
               </AISLE>
               <ROAD name="CheckStatusExit"
                      letter="Failure"
                      destination="Final" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="CheckStatusContinue"
                      letter="Continue"
                      destination="EnterTill" tape="ADVANCE" record="ON" index="ON">
                    <COMMENT>
                         Everything Ok with status check.
                    </COMMENT>
               </ROAD>               
          </SITE>                    
          <SITE name="EnterTill" siteaction="EnterTillSite">
               <AISLE name="TillEntered"
                      letter="Next"
                      laneaction="TillEnteredAisle">
               </AISLE>
               <AISLE name="EnterTillError"
                      letter="TillError"
                      laneaction="DisplayErrorAisle">
               </AISLE>
               <ROAD name="EnterTillErrorOk"
                      letter="Ok"
                      destination="EnterTill" tape="ADVANCE" record="ON" index="ON">
               </ROAD>               
               <ROAD name="EnterTillExit"
                      letter="Failure"
                      destination="Final" tape="ADVANCE" record="ON" index="ON">
               </ROAD>               
               <ROAD name="EnterTillUndo"
                      letter="Undo"
                      destination="Final" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="EnterTillCancel"
                      letter="Cancel"
                      destination="Final" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="EnterTillContinue"
                      letter="Continue"
                      destination="PromptRemoveTill" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
          </SITE>                  
          <SITE name="PromptRemoveTill" siteaction="PromptRemoveTillSite">
                <MOCKUP
                    image=""/>
                <AISLE
                    name="GiftCardBatchClose"
                    letter="Yes"
                    laneaction="MAXGiftCardBatchCloseAisle">
                    <COMMENT>
                        This Aisle is used to check the count of Total GiftCard issued in 
                        a Transaction.
                    </COMMENT>
                </AISLE>   
                 <ROAD
                    name="RemoveTill"
                    letter="NoIssue"
                    destination="OpenDrawer"
                    laneaction="RemoveTillRoad"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>                 
                  <ROAD
                    name="UndoTill"
                    letter="Undo"
                    destination="OpenDrawer"
                    laneaction="RemoveTillRoad"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
		<!-- Rev 1.1 changes -->
                  <AISLE
                    name="RetryTill"
                    letter="Retry"
                    laneaction="MAXGiftCardBatchCloseAisle">
                </AISLE> 
                <ROAD
                    name="DonotRemoveTill"
                    letter="No"
                    destination="UpdateStatus"
                    tape="ADVANCE"
                    record="ON"
                    index="ON">
                </ROAD>
          </SITE>         
          <SITE name="OpenDrawer" siteaction="OpenDrawerSite">
               <AISLE name="OpenDrawerFailureConversion"
                      letter="Cancel"
                      laneaction="FailureConversionAisle">
                    <COMMENT>
                         converts the letter Cancel to Failure
                    </COMMENT>
               </AISLE>
               <ROAD name="OpenDrawerContinue"
                      letter="Continue"
                      destination="CloseDrawer"
                      tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="OpenDrawerRetry"
                      letter="Retry"
                      destination="OpenDrawer"
                      tape="ADVANCE" record="ON" index="ON">
                    <COMMENT>
                         users selects Retry when cash drawer has a device
                         exception
                    </COMMENT>
               </ROAD>
               <ROAD name="OpenDrawerFailure"
                      letter="Failure"
                      destination="Final"
                      tape="ADVANCE" record="ON" index="ON">
               </ROAD>
          </SITE> 
          <SITE name="CloseDrawer" siteaction="CloseDrawerSite">
               <ROAD name="DrawerClosed"
                     letter="Continue"
                     destination="UpdateStatus"
                     tape="ADVANCE" record="ON" index="ON">
               </ROAD>
          </SITE>          
          <SITE name="UpdateStatus" siteaction="UpdateStatusSite">
               <AISLE name="UpdateStatusError"
                      letter="UpdateError"
                      laneaction="UpdateStatusErrorAisle">
               </AISLE>
               <AISLE name="UpdateStatusErrorOk"
                      letter="Ok"
                      laneaction="FailureConversionAisle">
               </AISLE>
               <ROAD name="UpdateSucceeded"
                      letter="Success"
                      destination="WriteHardTotals"
                      tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="UpdateFailed"
                      letter="Failure"
                      destination="TillReconcileOption" tape="ADVANCE" record="ON" index="ON">
                      <LIGHT signal="IsRequestedServiceTillReconcileSignal" negate="Y"/>
               </ROAD>
               <ROAD name="UpdateFailedFromReconcile"
                      letter="Failure"
                      destination="Final" tape="ADVANCE" record="ON" index="ON">
                      <LIGHT signal="IsRequestedServiceTillReconcileSignal"/>
               </ROAD>
	       <!--Changes done for HDD Full Patch From Oracle Start-->
               <ROAD name="UpdateStatusRetry"
                      letter="Retry"
                      destination="UpdateStatus" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="UpdateStatusQueueFull"
                     letter="QueueFull"
                     destination="Final" tape="ADVANCE" record="ON" index="ON">
               </ROAD>
	       <!--Changes done for HDD Full Patch From Oracle Ends-->
          </SITE>            
          <SITE name="WriteHardTotals" siteaction="WriteHardTotalsSite">
               <AISLE name="WriteHardTotalsError"
                      letter="Failure"
                      laneaction="WriteHardTotalsErrorAisle">
               </AISLE>
               <AISLE name="WriteHardTotalsErrorOk"
                      letter="Ok"
                      laneaction="FailureConversionAisle">
               </AISLE>
               <ROAD name="WriteHardTotalsSucceeded"
                     letter="Success"
                     destination="TillReconcileOption" tape="ADVANCE" record="ON" index="ON">
                     <LIGHT signal="IsRequestedServiceTillReconcileSignal" negate="Y"/>
               </ROAD>
               <ROAD name="WriteHardTotalsFailed"
                     letter="Failure"
                     destination="TillReconcileOption" tape="ADVANCE" record="ON" index="ON">
                     <LIGHT signal="IsRequestedServiceTillReconcileSignal" negate="Y"/>
               </ROAD>
               <ROAD name="WriteHardTotalsSucceededFromReconcile"
                     letter="Success"
                     destination="Final" tape="ADVANCE" record="ON" index="ON">
                     <LIGHT signal="IsRequestedServiceTillReconcileSignal"/>
               </ROAD>
               <ROAD name="WriteHardTotalsFailedFromReconcile"
                     letter="Failure"
                     destination="Final" tape="ADVANCE" record="ON" index="ON">
                     <LIGHT signal="IsRequestedServiceTillReconcileSignal"/>
               </ROAD>
          </SITE>                    
          <SITE name="TillReconcileOption" siteaction="TillReconcileOptionSite">
               <AISLE name="ReconcileTillNo"
                      letter="No"
                      laneaction="SuccessConversionAisle">
               </AISLE>
               <ROAD name="ReconcileTill"
                     letter="Yes"
                     destination="TillReconcileStation"
                     tape="ADVANCE" record="ON" index="ON">
               </ROAD>
               <ROAD name="CloseTillExit"
                     letter="Success"
                     destination="Final"
                     tape="ADVANCE" record="ON" index="ON">
               </ROAD>
          </SITE>                                            
          <STATION name="TillReconcileStation"
                servicename="till.tillreconcile.tillreconcile"
                targettier="CURRENTTIER"
                launchshuttle="TillReconcileLaunchShuttle"
                returnshuttle="TillReconcileReturnShuttle">
                <ROAD
                    name="ReconcileTillSucceeded"
                    letter="Success"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
                <ROAD
                    name="ReconcileTillFailed"
                    letter="Failure"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
                <ROAD name="TillReconcileUndo"
                     letter="Undo"
                     destination="Final" tape="ADVANCE" record="ON" index="ON">
                </ROAD>
                <ROAD
                    name="TillReconcileCancelled"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
		<!--Changes done for HDD Full Patch From Oracle Start-->
                <ROAD
                    name="TillReconcileQueueFull"
                    letter="QueueFull"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
		<!--Changes done for HDD Full Patch From Oracle end-->
          </STATION>

          <SYSTEMSITE name="Final" action="RETURN">
          </SYSTEMSITE>
          <SYSTEMSITE name="LastIndexed" action="BACKUP">
          </SYSTEMSITE>
     </REGION>
</MAP>
</SERVICE>
