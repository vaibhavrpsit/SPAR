<?xml version='1.0' ?>
<!--
/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  Copyright (c) 2012 - 2013 MAXHyperMarket, Inc.    All Rights Reserved.
  Rev 1.1	11/06/2013	Jyoti	 		Fix for bug 6080Emp. Disc. Remove - System is asking Manager 
  Override on every step and Bug 6077 - Emp. Disc.- System is asking Manager Override on every step
  Rev 1.0	5/04/2013	Jyoti	 		Initial Draft: Changes for Employee Discount
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
-->
<!DOCTYPE SERVICE SYSTEM "classpath://oracle/retail/stores/foundation/tour/dtd/tourguide.dtd">

<SERVICE name="EmployeeDiscount" package="max.retail.stores.pos.services.pricing.employeediscount"
	tourcam="OFF">
	<CARGO class="PricingCargo" package="oracle.retail.stores.pos.services.pricing" />
	<SERVICECODE>
		<LETTER name="Amount" />
		<LETTER name="Percent" />
		<LETTER name="Cancel" />
		<LETTER name="Next" />
		<LETTER name="Yes" />
		<LETTER name="No" />
		<LETTER name="Ok" />
		<LETTER name="Clear" />
		<LETTER name="Continue" />
		<LETTER name="Failure" />
		<LETTER name="Success" />
		<LETTER name="Override" />
		<LETTER name="Undo" />
		<LETTER name="AutoEmpDisc" /><!-- Rev 1.0 changes -->
		<LETTER name="EmpDiscAuto" /><!-- Rev 1.0 changes -->
		<LETTER name="EmpDiscAuto" />
		<LETTER name="RemoveAutoEmpDisc" />
		<LETTER name="PercentOverrideYes" />
		<LETTER name="AmountOverrideYes" />

		<SIGNAL class="IsAmountDiscountSignal" package="oracle.retail.stores.pos.services.pricing" />
		<SIGNAL class="IsPercentDiscountSignal" package="oracle.retail.stores.pos.services.pricing" />
		<!-- Rev 1.0 changes start here-->
		<LANEACTION class="MAXAmountEnteredAisle"
			package="max.retail.stores.pos.services.pricing.employeediscount" />
		<LANEACTION class="MAXPercentEnteredAisle"
			package="max.retail.stores.pos.services.pricing.employeediscount" />

		<!-- Rev 1.0 changes end here-->
		<LANEACTION class="ProrateAmountDiscountAisle"
			package="oracle.retail.stores.pos.services.pricing" />

		<SHUTTLE class="SecurityOverrideLaunchShuttle"
			package="oracle.retail.stores.pos.services.admin.security.common" />
			<!-- Rev 1.0 changes start here-->
		<SITEACTION class="MAXCheckAccessSite"
			package="max.retail.stores.pos.services.admin.security.common" />
		<SITEACTION class="CheckAccessSite"
			package="oracle.retail.stores.pos.services.admin.security.common" />
			<!-- Rev 1.0 changes end here-->
		<SITEACTION class="CheckProrateParameterSite"
			package="oracle.retail.stores.pos.services.pricing" />
		<SITEACTION class="CheckEmployeeDiscountAllowedSite"
			package="oracle.retail.stores.pos.services.pricing.employeediscount" />
		<SITEACTION class="CheckDiscountAlreadyAppliedSite"
			package="oracle.retail.stores.pos.services.pricing.employeediscount" />
		<SITEACTION class="ModifyItemDiscountSite"
			package="oracle.retail.stores.pos.services.pricing.employeediscount" />
		<SITEACTION class="ApplyDiscountAmountSite"
			package="oracle.retail.stores.pos.services.pricing.employeediscount" />
		<SITEACTION class="ApplyDiscountPercentSite"
			package="oracle.retail.stores.pos.services.pricing.employeediscount" />

	</SERVICECODE>
	<MAP>
		<!-- REGION region="SERVICE" startsite="CheckSecurityAccess"-->
		<REGION region="SERVICE" startsite="CheckEmployeeDiscountAllowed">
		<!-- Rev 1.1 changes start here -->
			<!-- SITE name="CheckSecurityAccess" siteaction="CheckAccessSite">
				<ROAD name="AccessDenied" letter="Override" destination="SecurityOverrideStation">
				</ROAD>
				<ROAD name="AccessGranted" letter="Continue"
					destination="CheckEmployeeDiscountAllowed">
				</ROAD>
			</SITE-->
			<!-- STATION name="SecurityOverrideStation" servicename="security.override.override"
				targettier="CURRENTTIER" launchshuttle="SecurityOverrideLaunchShuttle">
		
				<ROAD name="SecurityOverrideCancelled" letter="Cancel"
					destination="Final">
				</ROAD>

				<ROAD name="ItemDiscountPercentModified" letter="Success"
					destination="ApplyDiscountPercent">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount percent was added. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="SuccessSelected" letter="Success" destination="ApplyDiscountAmount">
					<LIGHT signal="IsAmountDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>

				<ROAD name="ItemDiscountPercentModified" letter="Failure"
					destination="ModifyItemDiscount">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount percent was added. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="MultipleInvalidItemDiscountAmountYesSelected"
					letter="Failure" destination="ModifyItemDiscount">
					<LIGHT signal="IsAmountDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="MultipleInvalidItemDiscountPercentYesSelected"
					letter="Yes" destination="ApplyDiscountPercent">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>
			</STATION-->
		<!-- Rev 1.1 changes end here -->
			<SITE name="CheckEmployeeDiscountAllowed" siteaction="CheckEmployeeDiscountAllowedSite">
				<ROAD name="EmployeeDiscountSucceeded" letter="Next"
					destination="CheckDiscountAlreadyApplied">
				</ROAD>
				<ROAD name="EmployeeDiscountFailed" letter="Cancel"
					destination="Final">
				</ROAD>
			</SITE>
			<SITE name="CheckDiscountAlreadyApplied" siteaction="CheckDiscountAlreadyAppliedSite">
				<ROAD name="CheckDiscountAlreadyAppliedContinue" letter="Continue"
					destination="ModifyItemDiscount">
					<LIGHT signal="IsPercentDiscountSignal" />
				</ROAD>
				<ROAD name="CheckDiscountAlreadyAppliedProrate" letter="Continue"
					destination="CheckProrateParameter">
					<LIGHT signal="IsAmountDiscountSignal" />
				</ROAD>
				<ROAD name="CheckDiscountAlreadyAppliedCancel" letter="Cancel"
					destination="Final">
				</ROAD>

			</SITE>

			<SITE name="CheckProrateParameter" siteaction="CheckProrateParameterSite">
				<AISLE name="DiscountConfirmationYesSelected" letter="Yes"
					laneaction="ProrateAmountDiscountAisle">
				</AISLE>
				<ROAD name="CheckProrateParameterContinue" letter="Continue"
					destination="ModifyItemDiscount">
				</ROAD>
				<ROAD name="DiscountConfirmationNoSelected" letter="No"
					destination="ModifyItemDiscount">
				</ROAD>
				<ROAD name="ProrateErrorAcknowledged" letter="Ok"
					destination="ModifyItemDiscount">
				</ROAD>
				<ROAD name="CheckProrateParameterCancel" letter="Cancel"
					destination="Final">
				</ROAD>
			</SITE>

			<!-- Modify Item Discount Site -->
			<SITE name="ModifyItemDiscount" siteaction="ModifyItemDiscountSite">
				<COMMENT>
					Modify the discount amount for the selected item.
					Pressing the clear key indicates the discount should
					be removed altogether. Prompt the user for a reason
					code. A null reason will not be allowed if an amount
					was entered.
                </COMMENT>
					<!-- Rev 1.0 changes start here-->
				<AISLE name="AmountEntered" letter="Next" laneaction="MAXAmountEnteredAisle">
					<LIGHT signal="IsAmountDiscountSignal" />
				</AISLE>
				<AISLE name="PercentEntered" letter="Next" laneaction="MAXPercentEnteredAisle">
					<LIGHT signal="IsPercentDiscountSignal" />
				</AISLE>


				
				<AISLE name="PercentEntered" letter="AutoEmpDisc" laneaction="MAXPercentEnteredAisle">
					<LIGHT signal="IsPercentDiscountSignal" />
				</AISLE>


					<!-- Rev 1.0 changes end here-->
				<ROAD name="MultiDiscountAmountInvalid" letter="No"
					destination="ModifyItemDiscount">
					<COMMENT>
						The discount was not valid. Return to the ModifyItemDiscountAmount
						site.
                    </COMMENT>
				</ROAD>
				<ROAD name="SingleDiscountAmountInvalid" letter="Ok"
					destination="ModifyItemDiscount">
					<COMMENT>
						The discount was not valid. Return to the ModifyItemDiscountAmount
						site.
                    </COMMENT>
				</ROAD>
				<ROAD name="ItemDiscountAmountModified" letter="Continue"
					destination="ApplyDiscountAmount">
					<LIGHT signal="IsAmountDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="ItemDiscountPercentModified" letter="Continue"
					destination="ApplyDiscountPercent">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount percent was added. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="MultipleInvalidItemDiscountAmountYesSelected"
					letter="Yes" destination="ApplyDiscountAmount">
					<LIGHT signal="IsAmountDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="MultipleInvalidItemDiscountPercentYesSelected"
					letter="Yes" destination="ApplyDiscountPercent">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="CancelItemDiscount" letter="Cancel" destination="Final">
				</ROAD>
				<ROAD name="UndoItemDiscount" letter="Undo" destination="Final">
				</ROAD>
				<ROAD name="ClearItemDiscount" letter="Clear" destination="Final">
				</ROAD>
					<!-- Rev 1.0 changes start here-->
				<ROAD name="PercentOverrideSelected" letter="PercentOverrideYes"
					destination="EmployeeDiscAccess">
				</ROAD>
				<ROAD name="AmountOverrideSelected" letter="AmountOverrideYes"
					destination="EmployeeDiscAccess">
				</ROAD>
				<ROAD name="AutomaticEmployeeDiscount" letter="EmpDiscAuto"
					destination="ApplyDiscountAmount">
				</ROAD>

					<!-- Rev 1.0 changes end here-->
			</SITE>


				<!-- Rev 1.0 changes start here-->
			<SITE name="EmployeeDiscAccess" siteaction="CheckAccessSite">

				<ROAD name="ManagerOverrideChosen" letter="Override"
					destination="SecurityOverrideStation" tape="ADVANCE" record="OFF"
					index="OFF">
				</ROAD>

				<!--<ROAD name="ManagerOverrideChosen" letter="Continue" destination="SecurityOverrideStation" 
					tape="ADVANCE" record="OFF" index="OFF"> </ROAD> -->
				<ROAD name="ItemDiscountPercentModified" letter="Continue"
					destination="ApplyDiscountPercent">
					<LIGHT signal="IsPercentDiscountSignal" />
					<COMMENT>
						The discount percent was added. Apply it.
                    </COMMENT>
				</ROAD>
				<ROAD name="SuccessSelected" letter="Continue" destination="ApplyDiscountAmount">
					<LIGHT signal="IsAmountDiscountSignal" />
					<COMMENT>
						The discount was entered. Apply it.
                    </COMMENT>
				</ROAD>


			</SITE>

				<!-- Rev 1.0 changes end here-->

			<!-- Apply Discount Amounts site -->
			<SITE name="ApplyDiscountAmount" siteaction="ApplyDiscountAmountSite">
				<ROAD name="DiscountAmountApplied" letter="Next" destination="Final">
					<COMMENT>
						The discount was applied, go on to the final site.
                    </COMMENT>
				</ROAD>
			</SITE>

			<!-- Apply Discount Percent Site -->
			<SITE name="ApplyDiscountPercent" siteaction="ApplyDiscountPercentSite">
				<ROAD name="DiscountPercentValid" letter="Next" destination="Final">
					<COMMENT>
						The discount was applied, go on to the final site.
                    </COMMENT>
				</ROAD>
			</SITE>
			<SYSTEMSITE name="Final" action="RETURN" />
		</REGION>
	</MAP>
</SERVICE>

