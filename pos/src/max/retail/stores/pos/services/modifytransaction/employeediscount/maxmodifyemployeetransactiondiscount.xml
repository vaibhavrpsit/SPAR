<?xml version='1.0' ?>
<!-- 
/********************************************************************************
 *   
 *	Copyright (c) 2016 - 2017 MAX Hypermarket, Inc    All Rights Reserved.
 *	
 *
 *	Rev 1.0		Nov 15, 2016        Ashish Yadav    Home Delivery Order FES
 ********************************************************************************/
 -->
<!DOCTYPE SERVICE SYSTEM "classpath://oracle/retail/stores/foundation/tour/dtd/tourguide.dtd">

<SERVICE name="ModifyEmployeeTransactionDiscount"
         package="oracle.retail.stores.pos.services.modifytransaction.employeediscount"
         tourcam="OFF">
     <CARGO class="MAXModifyTransactionDiscountCargo" package="max.retail.stores.pos.services.modifytransaction.discount"/>
     <SERVICECODE>
          <LETTER name="Percent"/>
          <LETTER name="Dollar"/>
          <LETTER name="Continue"/>
          <LETTER name="Success"/>
          <LETTER name="Failure"/>
          <LETTER name="Next"/>
          <LETTER name="Undo"/>
          <LETTER name="Ok"/>
          <LETTER name="Cancel"/>
          <LETTER name="Clear"/>
          <LETTER name="Override"/>
          <!-- Rev 1.0 changes start here -->
          <LETTER name="Employee"/>
          <LETTER name="AutoEmpDisc"/>
          <LETTER name="RemoveEmpDiscAuto" />
		<LETTER name="EmpDiscAuto" />
		<!-- Rev 1.0 changes end here -->
          <SHUTTLE class="SecurityOverrideLaunchShuttle" package="oracle.retail.stores.pos.services.admin.security.common"/>

          <SITEACTION class="DiscountPercentSite" package="oracle.retail.stores.pos.services.modifytransaction.discount"/>
          <SITEACTION class="DiscountDollarSite" package="oracle.retail.stores.pos.services.modifytransaction.discount"/>
          <SITEACTION class="StartSite" package="oracle.retail.stores.pos.services.modifytransaction.discount"/>
          <SITEACTION class="CreateRetailTransactionSite" package="oracle.retail.stores.pos.services.common"/>
          <SITEACTION class="CheckAccessSite" package="oracle.retail.stores.pos.services.admin.security.common"/>
           <!-- Rev 1.0 changes start here -->
          <SITEACTION class="CheckDiscountAlreadyAppliedSite" package="oracle.retail.stores.pos.services.modifytransaction.discount"/>
	  	<SITEACTION class="MAXCheckDiscountAlreadyAppliedSite"
			package="max.retail.stores.pos.services.modifytransaction.discount" />
          <!-- Rev 1.0 changes end here -->
          <SITEACTION class="MAXModifyItemDiscountSite" package="max.retail.stores.pos.services.pricing.employeediscount"/>

          <LANEACTION class="NextLetterAisle" package="oracle.retail.stores.pos.services.common"/>
          <LANEACTION class="UndoLetterAisle" package="oracle.retail.stores.pos.services.common"/>

          <LANEACTION class="FailureConversionAisle" package="oracle.retail.stores.pos.services.common"/>
          <LANEACTION class="AmountEnteredAisle"/>
          <LANEACTION class="PercentEnteredAisle"/>
       		 <!-- Rev 1.0 changes start here -->
          <LANEACTION class="MAXPercentEnteredAisle" package="max.retail.stores.pos.services.modifytransaction.employeediscount"/>
         <LANEACTION class="MAXRemovePercentEnteredAisle"
			package="max.retail.stores.pos.services.pricing.employeediscount" />
           <!-- Rev 1.0 changes end here -->
          <SIGNAL class="IsAmountDiscountSignal" package="oracle.retail.stores.pos.services.pricing"/>
          <SIGNAL class="IsPercentDiscountSignal" package="oracle.retail.stores.pos.services.pricing"/>

     </SERVICECODE>
     <MAP>
        <!-- REGION region="SERVICE" startsite="CheckAccess"-->
        <REGION region="SERVICE" startsite="CheckDiscountAlreadyApplied">
        <!-- Rev 1.1 changes start here -->
            <!-- SITE name="CheckAccess" siteaction="CheckAccessSite">
                <ROAD
                    name="NoAccess"
                    letter="Override"
                    destination="SecurityOverrideStation">
                </ROAD>
                <ROAD
                    name="UserAuthorized"
                    letter="Continue"
                    destination="CheckDiscountAlreadyApplied">
                </ROAD>
            </SITE>

            <STATION name="SecurityOverrideStation"
                servicename="security.override.override"
                targettier="CURRENTTIER"
                launchshuttle="SecurityOverrideLaunchShuttle" >
                <ROAD
                    name="LoginSucceededSecurityOverride"
                    letter="Success"
                    destination="CheckDiscountAlreadyApplied"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
                <ROAD
                    name="SecurityOverrideFailed"
                    letter="Failure"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
                <ROAD
                    name="SecurityOverrideCancelled"
                    letter="Cancel"
                    destination="Final"
                    tape="ADVANCE" record="OFF" index="OFF">
                </ROAD>
            </STATION-->
            <!-- Rev 1.1 changes end here -->
          <SITE name="CheckDiscountAlreadyApplied" siteaction="MAXCheckDiscountAlreadyAppliedSite">  <!-- Rev 1.0 changes -->
                <ROAD
                    name="CheckDiscountAlreadyAppliedContinue"
                    letter="Continue"
                    destination="ModifyItemDiscount">
                </ROAD>
                <ROAD
                    name="CheckDiscountAlreadyAppliedCancel"
                    letter="Cancel"
                    destination="Final">
                </ROAD>
            </SITE>
          <SITE name="ModifyItemDiscount" siteaction="MAXModifyItemDiscountSite"> <!-- Rev 1.0 changes -->
                <COMMENT>
                    Modify the discount amount for the selected item.
                    Pressing the clear key indicates the discount should
                    be removed altogether. Prompt the user for a reason
                    code. A null reason will not be allowed if an amount
                    was entered.
                </COMMENT>
                <!--  Changes start for Rev 1.0 (Ashish : Employee discount -->
                    <AISLE name="PercentEnteredNext"
                           letter="Next"
                           laneaction="MAXPercentEnteredAisle">  <!-- Rev 1.0 changes -->
                    <LIGHT signal="IsPercentDiscountSignal"/>
                         <COMMENT>
                              This aisle is traversed when an percentage
                              is entered in the UI.
                         </COMMENT>
                    </AISLE>
                    <!--  Changes start for Rev 1.0 (Ashish : Employee discount -->
                    <AISLE name="PercentEntered"
                           letter="AutoEmpDisc"
                           laneaction="MAXPercentEnteredAisle">  
                           <LIGHT signal="IsPercentDiscountSignal"/>                 
                         <COMMENT>
                              This aisle is traversed when an percentage
                              is entered in the UI.
                         </COMMENT>
                    </AISLE>
                    <AISLE name="RemovePercentEntered" letter="RemoveAutoEmpDisc"
					laneaction="MAXRemovePercentEnteredAisle">

				</AISLE>
		       
                    <AISLE name="AmountEntered"
                           letter="Next"
                           laneaction="AmountEnteredAisle">
                     <LIGHT signal="IsAmountDiscountSignal"/>
                         <COMMENT>
                              This aisle is traversed when the Accept key
                              is pressed.
                         </COMMENT>
                    </AISLE>
             
				<ROAD name="AutomaticEmployeeDiscount" letter="EmpDiscAuto"
					destination="CreateRetailTransaction">
				</ROAD>
				<ROAD name="RemoveAutomaticEmployeeDiscount" letter="RemoveEmpDiscAuto"
					destination="CreateRetailTransaction">
				</ROAD>
				<!-- Rev 1.0 changes end here-->
                    <ROAD name="InvalidValueEntered"
                          letter="Ok"
                          destination="ModifyItemDiscount"
                          tape="ADVANCE" record="ON" index="ON">
                         <COMMENT>
                              This road is traversed when a percentage
                              entered is out of range.
                         </COMMENT>
                    </ROAD>
                    <ROAD name="PercentRecorded"
                          letter="Continue"
                          destination="CreateRetailTransaction"
                          tape="ADVANCE" record="ON" index="ON">
                         <COMMENT>
                              This road is traveled when the percent and reason
                              code have been saved to the cargo.
                         </COMMENT>
                    </ROAD>

                    <ROAD name="UndoService"
                          letter="Undo"
                          destination="Final"
                          tape="ADVANCE" record="OFF" index="OFF">
                         <COMMENT>
                              This road is traversed when the service is
                              exiting because of a user access error.
                         </COMMENT>
                    </ROAD>
                <ROAD
                    name="CancelItemDiscount"
                    letter="Cancel"
                    destination="Final">
                </ROAD>
                 <ROAD
                    name="ClearItemDiscount"
                    letter="Clear"
                    destination="Final">
                </ROAD>
            </SITE>


               <SITE name="CreateRetailTransaction"
                     siteaction="CreateRetailTransactionSite">
                    <COMMENT>
                         This site creates the retail tansaction.
                    </COMMENT>
                    <AISLE name="TransactionCreated"
                           letter="Success"
                           laneaction="NextLetterAisle">
                         <COMMENT>
                              This aisle is traversed after the transaction
                              has been created.
                         </COMMENT>
                    </AISLE>
                    <AISLE name="TransactionFailed"
                           letter="Failure"
                           laneaction="NextLetterAisle">
                         <COMMENT>
                              This aisle is traversed if the transaction
                              is not created.
                         </COMMENT>
                    </AISLE>
                    <ROAD name="ExitService"
                          letter="Next"
                          destination="Final"
                          tape="ADVANCE" record="OFF" index="OFF">
                         <COMMENT>
                              This road is traversed after the transaction
                              has been created.
                         </COMMENT>
                    </ROAD>
               </SITE>
               <SYSTEMSITE name="Final" action="RETURN"/>
          </REGION>
     </MAP>
</SERVICE>
